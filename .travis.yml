
os:
  - linux
  - osx

sudo: true

env:
  - MSYS2=true
  - MSYS2=false

matrix:
  exclude:
    - { os: osx, env: MSYS2=true }
    - { os: linux, env: MSYS2=true, compiler: clang}

language: c

before_install:
  - if [[ "$TRAVIS_OS_NAME" == "linux" && "$MSYS2" == "true" ]]; then export DISPLAY=:99.0; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" && "$MSYS2" == "true" ]]; then /sbin/start-stop-daemon --start --quiet --pidfile /tmp/custom_xvfb_99.pid --make-pidfile --background --exec /usr/bin/Xvfb -- :99 -ac -screen 0 800x600x16; fi

install:
  - if [ "$TRAVIS_OS_NAME" == "osx" ]; then brew update > /dev/null; fi
  - if [ "$TRAVIS_OS_NAME" == "osx" ]; then brew install openssl libidn rtmpdump libssh2 c-ares libmetalink libressl nghttp2; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" && "$MSYS2" == "true" ]]; then sudo add-apt-repository -y ppa:pipelight/stable; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" && "$MSYS2" == "true" ]]; then sudo apt-get update -qq && sudo apt-get install -y --install-recommends wine-staging wine-staging-compat subversion; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" && "$MSYS2" == "true" ]]; then wget https://dl.dropboxusercontent.com/u/38458267/msys2/msys2-base-i686-20150512-20150731.deb; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" && "$MSYS2" == "true" ]]; then sudo dpkg -i msys2-base-i686-20150512-20150731.deb; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" && "$MSYS2" == "true" ]]; then msys2init; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" && "$MSYS2" == "true" ]]; then ln -svf ${PWD} ~/; fi

before_script:
  - if [[ "$TRAVIS_OS_NAME" == "linux" && "$MSYS2" == "true" ]]; then
       msys2run "cd curl && ./buildconf";
    else
       ./buildconf;
    fi

script:
  - if [[ "$TRAVIS_OS_NAME" == "linux" && "$MSYS2" == "true" ]]; then
       msys2run "cd curl && ./configure --enable-debug && make && make test-full";
    else
       ./configure --enable-debug && make && make test-full;
    fi

compiler:
  - clang
  - gcc

notifications:
  email: false
